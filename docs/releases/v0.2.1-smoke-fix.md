## v0.2.1-smoke-fix (2025-08-09)

Summary
- Smoke deployment unblocked by simplifying Storage diagnostics to metrics-only and hardening templates for variability across subscriptions/regions.

Changes
- Storage diagnostics: switch to metrics-only (AllMetrics) in smoke to avoid unsupported log category errors on existing accounts.
- Storage logs gating: previous logic attempted runtime kind detection; replaced with metrics-only for smoke reliability.
- Key Vault access policy: simplified to avoid referencing conditional/null identities.
- Orchestration: ACR disabled in smoke; no ACR outputs required.

Why it matters
- Eliminates deployment failures due to Storage diagnostic category mismatches (e.g., "Category 'StorageRead' is not supported").
- Keeps smoke deployments fast and consistent while preserving baseline observability.

Upgrade notes
- This affects smoke only. For non-smoke environments, re-enable explicit Storage log categories aligned to your storage kind (Blob* for BlockBlobStorage, Storage* for GPv2) once validated in your subscription/region.

Verification
- What-if clean for storage diagnostics creation.
- Deployment succeeded for rg-stamps-smoke; outputs include SQL and Storage MI principal IDs and regional public IP.

Tag
- v0.2.1-smoke-fix

